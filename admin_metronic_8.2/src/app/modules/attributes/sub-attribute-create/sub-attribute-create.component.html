<!--begin::Modal content CREATE-->
<div class="modal-content">
    <!-- Header -->
    <div class="modal-header">
        <h2 class="fw-bolder mb-0">Añadir Propiedad a {{attribute.name}}</h2>
        <button type="button" class="btn btn-icon btn-sm btn-active-icon-primary" (click)="modal.dismiss()">
            <i class="bi bi-x-lg fs-2"></i>
        </button>

    </div>

    <!-- Body -->
    <div class="modal-body py-5 px-7">
        <form class="form" novalidate>

            <!-- SECCIÓN: Datos básicos -->
            <h5 class="fw-bold text-gray-700 mb-3">Datos Básicos</h5>
            <div class="mb-4">
                <label class="form-label required">Nombre de la Propiedad</label>
                <input type="text" class="form-control" placeholder="Introduce el nombre" [(ngModel)]="name" name="name"
                    required />
            </div>

            <div class="row g-3 mb-4">
                <div class="col-md-6 col-12">
                    <label class="form-label required">Tipo de Propiedad</label>
                    <select class="form-select" [(ngModel)]="type_action" name="type_action" required>
                        <option value="1">General</option>
                        <option value="2">Color</option>
                    </select>
                </div>

                <div class="col-md-6 col-12" *ngIf="type_action == 2">
                    <label class="form-label required">Tipo de Color</label>
                    <select class="form-select" [(ngModel)]="colorType" name="colorType" required>
                        <option value="solid">Sólido</option>
                        <option value="multicolor">Multicolor</option>
                        <option value="gradient">Degradado</option>
                        <option value="pattern">Estampado</option>
                        <option value="animal">Animal Print</option>
                        <option value="tiedye">Tie-Dye</option>
                    </select>
                </div>
            </div>

            <!-- SECCIÓN: Configuración según tipo -->
            <h5 class="fw-bold text-gray-700 mb-3" *ngIf="type_action == 2">Configuración de Color</h5>

            <!-- Sólido -->
            <div *ngIf="type_action == 2 && colorType == 'solid'" class="mb-4">
                <label class="form-label">Selecciona un color</label>
                <input type="color" [(ngModel)]="color" name="color"
                    class="form-control form-control-color w-100 h-50px rounded" />
            </div>

            <!-- Multicolor -->
            <div *ngIf="colorType == 'multicolor'" class="mb-4">
                <label class="form-label">Colores </label>
                <div *ngFor="let c of multiColors; let i = index" class="d-flex gap-2 mb-2 align-items-center">
                    <input type="color" [(ngModel)]="multiColors[i]" [name]="'multiColor' + i"
                        class="form-control form-control-color flex-grow-1 h-45px" />
                    <button type="button" class="btn btn-sm btn-icon btn-danger" (click)="removeColor(i)">
                        <i class="bi bi-x-lg"></i>
                    </button>

                </div>
                <button type="button" class="btn btn-sm btn-light-primary" (click)="addColor()">+ Añadir Color</button>
            </div>

            <!-- Degradado -->
            <div *ngIf="colorType == 'gradient'" class="row g-3 mb-4">
                <div class="col-md-6">
                    <label class="form-label">Color Inicio</label>
                    <input type="color" [(ngModel)]="gradient.start" name="gradientStart"
                        class="form-control form-control-color w-100 h-45px" />
                </div>
                <div class="col-md-6">
                    <label class="form-label">Color Fin</label>
                    <input type="color" [(ngModel)]="gradient.end" name="gradientEnd"
                        class="form-control form-control-color w-100 h-45px" />
                </div>
                <div class="col-12">
                    <label class="form-label">Dirección</label>
                    <select [(ngModel)]="gradient.direction" name="gradientDirection" class="form-select">
                        <option value="to right">Horizontal</option>
                        <option value="to bottom">Vertical</option>
                        <option value="circle">Radial</option>
                    </select>
                </div>
            </div>

            <!-- Imágenes -->
            <div *ngIf="['pattern','animal','tiedye'].includes(colorType)" class="mb-4">
                <label class="form-label fw-bold">Subir Imagen</label>
                <input type="file" (change)="onFileChange($event)" accept=".jpg,.jpeg,.png,.svg" class="form-control" />

                <div *ngIf="preview" class="mt-3 d-flex justify-content-center">
                    <div class="border rounded d-flex align-items-center justify-content-center"
                        style="width: 200px; height: 200px; overflow: hidden; background-color: #f8f9fa;">
                        <img [src]="preview" style="width: 100%; height: 100%; object-fit: contain;" />
                    </div>
                </div>
            </div>


            <!-- Botón Registrar -->
            <div class="d-flex justify-content-center my-4">
                <button type="button" class="btn btn-primary px-6" (click)="store()">
                    Registrar
                    <span class="spinner-border spinner-border-sm ms-2" *ngIf="isLoading$ | async"></span>
                </button>
            </div>

            <!-- SECCIÓN: Propiedades registradas -->
            <h5 class="fw-bold text-gray-700 mb-3">Propiedades Registradas</h5>
            <div class="table-responsive mb-4">
                <table class="table table-striped table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Nombre</th>
                            <th>Color</th>
                            <th class="text-end">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let propertie of pagedProperties">
                            <td>{{ propertie.name }}</td>
                            <td>
                                <ng-container *ngIf="propertie.code; else noColor">
                                    <div *ngIf="isHexColor(propertie.code)" class="color-circle"
                                        [style.background-color]="propertie.code"></div>
                                    <div *ngIf="isMultiColor(propertie.code)" class="color-circle"
                                        [style.background]="getMultiColorGradient(propertie.code)"></div>
                                    <div *ngIf="isGradient(propertie.code)" class="color-circle"
                                        [style.background]="getGradient(propertie.code)"></div>
                                    <div *ngIf="isImage(propertie.code)" class="color-circle">
                                        <img [src]="propertie.code" />
                                    </div>
                                </ng-container>
                                <ng-template #noColor>
                                    <span class="text-muted">--</span>
                                </ng-template>
                            </td>
                            <td class="text-end">
                                <button class="btn btn-sm btn-icon text-muted border-0 p-0"
                                    style="width: 40px; height: 40px;" (click)="delete(propertie)">
                                    <i class="bi bi-trash fs-5"></i>
                                </button>
                            </td>

                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Paginación -->
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    <li class="page-item" [class.disabled]="currentPage === 1">
                        <button class="page-link" (click)="changePage(currentPage - 1)">Anterior</button>
                    </li>

                    <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index"
                        [class.active]="currentPage === i+1">
                        <button class="page-link" (click)="changePage(i+1)">{{ i+1 }}</button>
                    </li>

                    <li class="page-item" [class.disabled]="currentPage === totalPages">
                        <button class="page-link" (click)="changePage(currentPage + 1)">Siguiente</button>
                    </li>
                </ul>
            </nav>


            <!-- Acciones finales -->
            <div class="text-center">
                <button type="reset" class="btn btn-light me-2 mt-4" (click)="modal.dismiss()">Cerrar</button>
            </div>
        </form>
    </div>
</div>
<!--end::Modal content CREATE-->